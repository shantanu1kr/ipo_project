{% extends 'companymaster/base.html' %}
{{ form.media }}        {# Form required JS and CSS #}
{% load static %}
{% load widget_tweaks %}
{% block content %}

<div class="container-fluid" id="headerbx" style="background-image:url('{% static 'asset/bg.jpg' %}');">
	<div class="container-fluid filtersearch">
		<div class="row">
			<div class="col-lg-6">
				<div class="headingbg">
					<h5><i class="icofont-plus"></i> Add Company</h5>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- MODAL -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <h4 class="modal-title">Add</h4>
		  <button type="button" class="close" data-dismiss="modal">
			<i class="icofont-close-circled"></i>
		  </button>
		</div>
		<div class="modal-body">
		  <div class="form-group">
					<label>Fund Party Name</label>
					<div class="line"></div>
					<input type='text' class='dtfc form-control' name='fundparty' id='addfund' />
			</div>
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		  <button type="button" class="btn btn-primary" onclick="addFundParty()">Save changes</button>
		</div>
	  </div>
	</div>
  </div>


  <!--Modal-->
<div class="modal fade" id="addpdf" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <h4 class="modal-title">Add</h4>
		  <button type="button" class="close" data-dismiss="modal">
			<i class="icofont-close-circled"></i>
		  </button>
		</div>
		<div class="modal-body">
		   <div class="form-group">
					<label>File Name</label>
					<div class="line"></div>
					<input type='text' class='dtfc form-control' name='filename' id='uploadfilename' />
			</div>
			<div class="form-group">
					<label>Add PDF LINK</label>
					<div class="line"></div>
					<input type='text' class='dtfc form-control' name='uri' id='pdf_uri' />
			</div>
		  <div class="form-group">
					<label>Add PDF File</label>
					<div class="line"></div>
					<input type='file' accept="application/pdf"  class='dtfc form-control' name='file' id='pdf_file' />
			</div>
		  
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		  <button type="button" class="btn btn-primary" onclick="addPDF()">Save changes</button>
		</div>
	  </div>
	</div>
  </div>

<div class="container-fluid" id="contentmaindiv">
	<div class="container-fluid whitepatch">
		<div class="tp_side">
			<div class="row">
				<div class="col-md-6">
					<h3 class="tb_head"><i class="icofont-info-circle"></i> Fund Party Information
					</h3>
				</div>
		
				<div class="col-md-6 col-sm-6 col-xs-2" style='display:flex;gap:4px;margin-left:auto;'>
					<button style='margin-left:auto;' data-toggle="modal" data-target="#addpdf" type="button" class="btn-sm btn-info btn fl_rg shw" data-original-title="" title=""><i class="icofont-plus"></i> <span>Add PDF</span></button>
					<button data-toggle="modal" data-target="#exampleModal" type="button" class="btn-sm btn-info btn fl_rg shw" data-original-title="" title=""><i class="icofont-plus"></i> <span>Add FundParty</span></button>
					<div style='width:100px;'>
					{{form2.pdf}}
					<div class="fr" ><a href="{% static 'asset/pdf.pdf' %}" target="_blank"><i class="icofont-file-pdf"></i>
							View PDF </a></div>
					
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-2 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label>Company</label>
					<div class="line"></div>
					{{form2.company}}
				</div>
			</div>

			<div class="col-md-2 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Lead Underwriter</label>
					{{form2.lead_underwriter}}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
					<div style='display:flex;gap:2px;margin-top:2px;'>
						{{form2.lead_underwriter_pdf}}
						{{form2.lead_underwriter_page_no}}
					</div>
					<!--<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>-->
				</div>
			</div>

			<div class="col-md-2 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Underwriter</label>
					{{form2.underwriter}}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
						<div style='display:flex;gap:2px;margin-top:2px;'>
						{{form2.underwriter_pdf}}
						{{form2.underwriter_page_no}}
					</div>
					<!--<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>-->
				</div>
			</div>

			<div class="col-md-2 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Underwriter Counsel</label>
					{{form2.u_counsel}}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
					<div class="fr"><a href="{% static 'asset/pdf.pdf' %}" download=""><i class="icofont-file-pdf"></i>
							View PDF </a></div>
					<!--<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>-->
				</div>
			</div>

			<div class="col-md-2 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Auditor</label>
					{{form2.auditors}}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
					<div style='display:flex;gap:2px;margin-top:2px;'>
						{{form2.auditors_pdf}}
						{{form2.auditors_page_no}}
					</div>
					<!--<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>-->
				</div>
			</div>

			<div class="col-md-2 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Transfer Agent</label>
					{{form2.transfer_agent}}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
					<div class="fr"><a href="{% static 'asset/pdf.pdf' %}" download=""><i class="icofont-file-pdf"></i>
							View PDF </a></div>
					<!--<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>-->
				</div>
			</div>

			<div class="col-md-2 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Company Counsel</label>
					{{form2.comp_counsel | attr:"value:1" }}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->

					<div class="fr"><a href="{% static 'asset/pdf.pdf' %}" download=""><i class="icofont-file-pdf"></i>
							View PDF </a></div>
					<!--<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>-->
				</div>
			</div>
		</div>

		<div class="tp_side">
			<div class="row">
				<div class="col-md-6">
					<h3 class="tb_head"><i class="icofont-info-circle"></i> Management Information
					</h3>
				</div>				
			</div>
		</div>

		<div class="row">

			<div class="col-md-4 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Directors</label>
					{{form2.directors}}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
				</div>
				<div class="form-group">
					{{form2.directors_description}}
					<!-- <textarea class="form-control" rows="3" id="comment"></textarea> -->
					<div class="fr"><a href="{% static 'asset/pdf.pdf' %}" download=""><i class="icofont-file-pdf"></i>
							View PDF </a></div>
					<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>
				</div>

			</div>
			<div class="col-md-4 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Chair. of B. Direc.</label>
					{{form2.chair_dir}}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
				</div>
				<div class="form-group">
					{{form2.chair_dir_description}}
					<!-- <textarea class="form-control" rows="3" id="comment"></textarea> -->
					<div class="fr"><a href="{% static 'asset/pdf.pdf' %}" download=""><i class="icofont-file-pdf"></i>
							View PDF </a></div>
					<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>
				</div>
			</div>
			<div class="col-md-4 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">CEO</label>
					{{form2.ceo}}
					
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
				</div>
				<div class="form-group">
					{{form2.ceo_description}}
					<!-- <textarea class="form-control" rows="3" id="comment"></textarea> -->

					<div style='display:flex;gap:2px;margin-top:2px;'>
						{{form2.ceo_pdf}}
						{{form2.ceo_page_no}}
					</div>
					<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>
				</div>
			</div>
			<div class="col-md-4 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">CFO</label>
					{{form2.cfo}}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
				</div>
				<div class="form-group">
					{{form2.cfo_description}}
					<!-- <textarea class="form-control" rows="3" id="comment"></textarea> -->
					<div class="fr"><a href="{% static 'asset/pdf.pdf' %}" download=""><i class="icofont-file-pdf"></i>
							View PDF </a></div>
					<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>
				</div>
			</div>

			<div class="col-md-4 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Director Nominee</label>
					{{form2.director_nominee}}
				</div>
				<div class="form-group">
					{{form2.director_nominee_description}}
					<div class="fr"><a href="{% static 'asset/pdf.pdf' %}" download=""><i class="icofont-file-pdf"></i>
					View PDF </a></div>
					<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>
				</div>
			</div>

			<div class="col-md-4 col-sm-3 col-xs-6 fcc">
				<div class="form-group">
					<label for="usr">Key Share Holder</label>
					{{form2.key_share_holder}}
					<!-- <input class="dtfc form-control" type="text" placeholder="Type..." /> -->
				</div>
				<div class="form-group">
					{{form2.key_share_holder_description}}
					<!-- <textarea class="form-control" rows="3" id="comment"></textarea> -->
					<div style='display:flex;gap:2px;margin-top:2px;'>
						{{form2.key_share_holder_pdf}}
						{{form2.key_share_holder_page_no}}
					</div>
					<div class="sc"><a href="#"><i class="icofont-plus"></i> Add More</a></div>
				</div>
			</div>


		</div>
	</div>
</div>

<div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<!--<a href="/company-search" type="button" class="btn btn-success shw">Update</a>-->
			<a href="/addcompany" type="button" class="btn btn-warning shw">Back</a>
			<a type="button" onclick="submitForm()" class="btn btn-success shw">Submit</a>
			<a href="/addcompany-3" type="button" class="btn btn-primary shw">Next</a>			
		</div>
	</div>
</div>


</div>
<!----------content-wrap-------------->

<div id="footer">
	<div class="container-fluid">
		<div class="pull-right hidden-xs">
			<b>Version</b> 2.4.0
		</div>Copyright © 2018-2019 <a href="https://www.decimalpointanalytics.com/" target="_blank">Decimal Point.</a>
		All rights reserved.
	</div>
</div>

</div>
<!----------page-container-------------->

<script>
	// javascript only have a method to add element before it, so this function add element after it.
	function insertAfter(newNode, referenceNode) {
    referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
	}

	// Getting all input containers
	let containers = Array.from($('.fcc'))
	// loop through each each container
	containers.forEach(item => {
		// getting addmore button
		const button = item.querySelector('.sc')
		if(button){
			// adding a click event
			button.addEventListener('click', function (e) {
			// cloning because it pass by reference 
			const temp = item.cloneNode(true)
			// clearing input value
			temp.querySelector('input').value = ''
			temp.querySelector('textarea').value = ''
			//modifying the addMore button rather than creating new element
			// adding delete class
			temp.querySelector('.sc').classList.add('delete')
			// changing addmore to Delete
			temp.querySelector('.sc a').innerText= 'Delete'
			const deleteBtn = temp.querySelector('.delete')
			// removing sc class because it has add field event
			deleteBtn.classList.remove('sc')
			deleteBtn.addEventListener('click',function(){
				// removing element container when click on delete field
				deleteBtn.parentNode.parentNode.remove(true)
			})
			// adding  new input 
			insertAfter(temp,item)
		});
		};		
	})

	function submitForm() {
		if($("#id_company").val()){
			var url = "{% url 'fundparty_submit_form' %}";
			var data = {};
			data['company'] = $("#id_company").val();
			data['lead_underwriter'] = $("#id_lead_underwriter").val();
			data['underwriter'] = $('#id_underwriter').val();
			data['u_counsel'] = $('#id_u_counsel').val();
			data['auditors'] = $('#id_auditors').val();
			data['transfer_agent'] = $('#id_transfer_agent').val();
			data['comp_counsel'] = $('#id_comp_counsel').val();
			data['director_nominee'] = Array.from(document.querySelectorAll('#id_director_nominee')).map(el=> el.value)
			data['director_nominee_description'] = Array.from(document.querySelectorAll('#id_director_nominee_description')).map(el=> el.value)
			data['key_share_holder'] = Array.from(document.querySelectorAll('#id_key_share_holder')).map(el=> el.value)
			data['key_share_holder_description'] = Array.from(document.querySelectorAll('#id_key_share_holder_description')).map(el=> el.value)			
			data['ceo'] = Array.from(document.querySelectorAll('#id_ceo')).map(el=> el.value)
			data['ceo_description'] = Array.from(document.querySelectorAll('#id_ceo_description')).map(el=> el.value)
			data['cfo'] = Array.from(document.querySelectorAll('#id_cfo')).map(el=> el.value)
			data['cfo_description'] = Array.from(document.querySelectorAll('#id_cfo_description')).map(el=> el.value)
			data['chair_dir'] = Array.from(document.querySelectorAll('#id_chair_dir')).map(el=> el.value)
			data['chair_dir_description'] = Array.from(document.querySelectorAll('#id_chair_dir_description')).map(el=> el.value)
			data['directors'] = Array.from(document.querySelectorAll('#id_directors')).map(el=> el.value)
			data['directors_description'] = Array.from(document.querySelectorAll('#id_directors_description')).map(el=> el.value)


			data['lead_underwriter_pdf'] = $('#id_lead_underwriter_pdf').val();
			data['lead_underwriter_page_no'] = $('#id_lead_underwriter_page_no').val();

			data['underwriter_pdf'] = $('#id_underwriter_pdf').val();
			data['underwriter_page_no'] = $('#id_underwriter_page_no').val();

			data['auditors_pdf'] = $('#id_auditors_pdf').val();
			data['auditors_page_no'] = $('#id_auditors_page_no').val();

			data['ceo_pdf'] = $('#id_ceo_pdf').val();
			data['ceo_page_no'] = $('#id_ceo_page_no').val();

			data['key_share_holder_pdf'] = $('#id_key_share_holder_pdf').val();
			data['key_share_holder_page_no'] = $('#id_key_share_holder_page_no').val();


			bootbox.confirm({
			message: "Confirm Submit?",
			buttons: {
				confirm: {
				label: 'Yes',
				className: 'btn-success'
				},
				cancel: {
				label: 'No',
				className: 'btn-danger'
				}
			},
			callback: function (result) {
				if(result){
					start_loading();
					$.ajax({
						url: url,
						method: 'POST',
						data: JSON.stringify(data),
						success: function (data) {
							stop_loading();
							make_alert("success","Fund Party and Management added successfully!");
						},
						error: function (jqXHR, status, err) {
							stop_loading();
							make_warning_alert("danger","Sorry, Something went wrong.");
						},
					});
				}
			}
		});
		}else{
			make_warning_alert("warning","Mandatory fields are required.")
		}
	}
</script> 

<script>
let pdfFilesEl = Array.from(document.querySelectorAll('.pdf-file'))
pdfFilesEl.forEach(el=>{
el.addEventListener('change',function(e){
	console.log(e.target.parentElement)
const parent = e.target.parentElement.parentElement;
parent.querySelector('.fr a').href = e.target.value


})
})
</script>

<script>
function addPDF(){
	 start_loading();
		file = $('#pdf_file')[0].files[0]
		uri = $('#pdf_uri').val()
		
		filename = $('#uploadfilename').val()
		var form = new FormData();
		form.append('filename',filename);
		form.append('file',file)
		form.append('uri',uri)
		form.append('action', 'add-pdf')
        form.append('csrfmiddlewaretoken', '{{ csrf_token }}')

		   $.ajax({ 
			url: '{% url "addpdf" %}',
			method: 'POST',
			cache: false,
              processData: false,
              contentType: false,
              enctype: 'multipart/form-data',
			data: form,
			success: function (data) {
				stop_loading();
				make_alert("success","PDF uploaded successfully !");
			},
			error: function (jqXHR, status, err) {
				stop_loading();
				make_warning_alert("danger","Sorry, Something went wrong.");
			},
		});  
		
}

</script>

<script>
	function addFundParty(){
		start_loading();
		fund = $('#addfund').val()
		data = {fund}
		$.ajax({
			url: '{% url "addfundparty" %}',
			method: 'POST',
			data: JSON.stringify(data),
			success: function (data) {
				stop_loading();
				make_alert("success","Fund Party added successfully !");
			},
			error: function (jqXHR, status, err) {
				stop_loading();
				make_warning_alert("danger","Sorry, Something went wrong.");
			},
		});
	}
</script>
{% endblock %}